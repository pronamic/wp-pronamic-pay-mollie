{"version":3,"file":"components.js","names":["$","components","id","label","component","initMollieComponents","forms","$cardTokenElements","document","querySelectorAll","forEach","$cardTokenElement","data","dataset","Error","mollie","Mollie","locale","testmode","componentsContainer","createElement","classList","add","append","setAttribute","innerText","field","error","mollieComponent","createComponent","mount","addEventListener","event","touched","textContent","remove","form","closest","e","cardTokenInput","querySelector","preventDefault","token","createToken","message","tokenInput","dispatchEvent","Event","cancelable","submitter","name","click","setupWooCommerce","checkoutForm","body","on","$form","returnFalse","off","submit","jQuery"],"sources":["../src/components.js"],"sourcesContent":["/* global Mollie */\n'use strict';\n\n/**\n * Mollie Components.\n *\n * @link https://docs.mollie.com/components/overview\n */\n( ( $ ) => {\n\tconst components = [\n\t\t{\n\t\t\tid: 'card-holder',\n\t\t\tlabel: 'Card Holder',\n\t\t\tcomponent: 'cardHolder'\n\t\t},\n\t\t{\n\t\t\tid: 'card-number',\n\t\t\tlabel: 'Card Number',\n\t\t\tcomponent: 'cardNumber'\n\t\t},\n\t\t{\n\t\t\tid: 'expiry-date',\n\t\t\tlabel: 'Expiry',\n\t\t\tcomponent: 'expiryDate'\n\t\t},\n\t\t{\n\t\t\tid: 'verification-code',\n\t\t\tlabel: 'CVC',\n\t\t\tcomponent: 'verificationCode'\n\t\t}\n\t];\n\n\tfunction initMollieComponents( forms ) {\n\t\tlet $cardTokenElements;\n\n\t\tif ( typeof forms === 'string' ) {\n\t\t\t$cardTokenElements = document.querySelectorAll( forms + ' .pronamic_pay_mollie_card_token' );\n\t\t} else {\n\t\t\t$cardTokenElements = forms.querySelectorAll( '.pronamic_pay_mollie_card_token' );\n\t\t}\n\n\t\t$cardTokenElements.forEach( ( $cardTokenElement ) => {\n\t\t\t// Create components.\n\t\t\tconst data = $cardTokenElement.dataset;\n\n\t\t\t// Check required Mollie profile ID.\n\t\t\tif ( ! ( \"mollie-profile-id\" in data ) ) {\n\t\t\t\tthrow new Error( 'No Mollie profile ID in element dataset. Unable to load Mollie Components.' );\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Initialize Mollie object.\n\t\t\tconst mollie = Mollie(\n\t\t\t\tdata['mollie-profile-id'],\n\t\t\t\t{\n\t\t\t\t\tlocale: data['mollie-locale'] ?? null,\n\t\t\t\t\ttestmode: ( \"mollie-testmode\" in data ),\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tlet componentsContainer = document.createElement( 'div' );\n\t\t\tcomponentsContainer.classList.add( 'mollie-components' );\n\n\t\t\t$cardTokenElement.append( componentsContainer );\n\n\t\t\tcomponents.forEach( ( component ) => {\n\t\t\t\t// Label.\n\t\t\t\tlet label = document.createElement( 'label' );\n\t\t\t\tlabel.setAttribute( 'for', component.id );\n\t\t\t\tlabel.innerText = component.label;\n\n\t\t\t\t// Component container.\n\t\t\t\tlet field = document.createElement( 'div' );\n\t\t\t\tfield.setAttribute( 'id', component.id );\n\n\t\t\t\tlabel.append( field );\n\n\t\t\t\t// Error.\n\t\t\t\tlet error = document.createElement( 'div' );\n\t\t\t\terror.setAttribute( 'id', component.id + '-error' );\n\t\t\t\terror.setAttribute( 'role', 'alert' );\n\t\t\t\terror.classList.add( 'field-error' );\n\n\t\t\t\tcomponentsContainer.append( label, error );\n\n\t\t\t\t// Create and mount component.\n\t\t\t\tlet mollieComponent = mollie.createComponent( component.component );\n\n\t\t\t\tmollieComponent.mount( '#' + component.id );\n\n\t\t\t\t// Handle errors.\n\t\t\t\tmollieComponent.addEventListener( 'change', ( event ) => {\n\t\t\t\t\t// Add error.\n\t\t\t\t\tif ( event.error && event.touched ) {\n\t\t\t\t\t\terror.textContent = event.error;\n\n\t\t\t\t\t\tlabel.classList.add( 'is-invalid' );\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Remove error.\n\t\t\t\t\terror.textContent = '';\n\n\t\t\t\t\tlabel.classList.remove( 'is-invalid' );\n\t\t\t\t} );\n\t\t\t} );\n\n\t\t\t// Create Mollie token on checkout submit.\n\t\t\tconst form = $cardTokenElement.closest( 'form' );\n\n\t\t\tform.addEventListener( 'submit', async ( e ) => {\n\t\t\t\t// Check existing card token input.\n\t\t\t\tlet cardTokenInput = form.querySelector( 'input[name=\"pronamic_pay_mollie_card_token\"]' );\n\n\t\t\t\tif ( cardTokenInput ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\te.preventDefault();\n\n\t\t\t\t// Create token.\n\t\t\t\tconst { token, error } = await mollie.createToken();\n\n\t\t\t\tif ( error ) {\n\t\t\t\t\tthrow new Error( error.message || '' );\n\t\t\t\t}\n\n\t\t\t\t// Add token to form.\n\t\t\t\tconst tokenInput = document.createElement( 'input' );\n\t\t\t\ttokenInput.setAttribute( 'type', 'hidden' );\n\t\t\t\ttokenInput.setAttribute( 'name', 'pronamic_pay_mollie_card_token' );\n\t\t\t\ttokenInput.setAttribute( 'value', token );\n\n\t\t\t\tform.append( tokenInput );\n\n\t\t\t\tif ( false !== form.dispatchEvent( new Event( 'pronamic_pay_mollie_components_card_token_added', { cancelable: true } ) ) ) {\n\t\t\t\t\t// Submit form, now containing the hidden card token field.\n\t\t\t\t\t// form.submit(); â€” not working with test meta box\n\t\t\t\t\tform.querySelector( '[name=\"' + e.submitter.name + '\"]' ).click();\n\t\t\t\t}\n\t\t\t} );\n\t\t} );\n\t}\n\n\tfunction setupWooCommerce() {\n\t\tconst checkoutForm = document.querySelector( 'form.woocommerce-checkout' );\n\n\t\tif ( ! checkoutForm ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Init components on updated checkout.\n\t\t$( document.body ).on( 'updated_checkout', function( e ) {\n\t\t\tinitMollieComponents( checkoutForm );\n\t\t} );\n\n\t\tconst $form = $( checkoutForm );\n\n\t\t// Prevent placing order, need to create token first.\n\t\t$form.on( 'checkout_place_order_pronamic_pay_credit_card', returnFalse );\n\n\t\t// Re-enable placing order if card token has been added.\n\t\tcheckoutForm.addEventListener( 'pronamic_pay_mollie_components_card_token_added', function( e ) {\n\t\t\te.preventDefault();\n\n\t\t\t$form.off( 'checkout_place_order_pronamic_pay_credit_card', returnFalse );\n\n\t\t\t$form.submit();\n\t\t} );\n\t}\n\n\tfunction returnFalse() {\n\t\treturn false;\n\t}\n\n\t// Init Mollie Components.\n\tdocument.addEventListener( 'DOMContentLoaded', function( e ) {\n\t\tinitMollieComponents( 'form:not(.woocommerce-checkout)' );\n\t} );\n\n\tsetupWooCommerce();\n} )( jQuery );\n"],"mappings":"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"}