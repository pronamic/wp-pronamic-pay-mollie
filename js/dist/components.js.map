{"version":3,"file":"components.js","names":["$","components","id","label","component","initMollieComponents","forms","$cardTokenElements","document","querySelectorAll","forEach","$cardTokenElement","data","dataset","Error","mollie","Mollie","locale","testmode","createElement","setAttribute","innerText","field","error","classList","add","append","mollieComponent","createComponent","mount","addEventListener","event","textContent","touched","form","closest","e","cardTokenInput","querySelector","preventDefault","token","createToken","message","tokenInput","dispatchEvent","Event","cancelable","submitter","name","click","setupWooCommerce","checkoutForm","body","on","$form","returnFalse","off","submit","jQuery"],"sources":["../src/components.js"],"sourcesContent":["/* global Mollie */\n\n'use strict';\n\n/**\n * Mollie Components.\n *\n * @link https://docs.mollie.com/components/overview\n */\n( ( $ ) => {\n\tconst components = [\n\t\t{\n\t\t\tid: 'card-number',\n\t\t\tlabel: 'Card Number',\n\t\t\tcomponent: 'cardNumber'\n\t\t},\n\t\t{\n\t\t\tid: 'card-holder',\n\t\t\tlabel: 'Card Holder',\n\t\t\tcomponent: 'cardHolder'\n\t\t},\n\t\t{\n\t\t\tid: 'expiry-date',\n\t\t\tlabel: 'Expiry Date',\n\t\t\tcomponent: 'expiryDate'\n\t\t},\n\t\t{\n\t\t\tid: 'verification-code',\n\t\t\tlabel: 'Verification Code',\n\t\t\tcomponent: 'verificationCode'\n\t\t}\n\t];\n\n\tfunction initMollieComponents( forms ) {\n\t\tlet $cardTokenElements;\n\n\t\tif ( typeof forms === 'string' ) {\n\t\t\t$cardTokenElements = document.querySelectorAll( forms + ' .pronamic_pay_mollie_card_token' );\n\t\t} else {\n\t\t\t$cardTokenElements = forms.querySelectorAll( '.pronamic_pay_mollie_card_token' );\n\t\t}\n\n\t\t$cardTokenElements.forEach( ( $cardTokenElement ) => {\n\t\t\t// Create components.\n\t\t\tconst data = $cardTokenElement.dataset;\n\n\t\t\t// Check required Mollie profile ID.\n\t\t\tif ( ! ( \"mollie-profile-id\" in data ) ) {\n\t\t\t\tthrow new Error( 'No Mollie profile ID in element dataset. Unable to load Mollie Components.' );\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Initialize Mollie object.\n\t\t\tconst mollie = Mollie(\n\t\t\t\tdata['mollie-profile-id'],\n\t\t\t\t{\n\t\t\t\t\tlocale: data['mollie-locale'] ?? null,\n\t\t\t\t\ttestmode: ( \"mollie-testmode\" in data ),\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tcomponents.forEach( ( component ) => {\n\t\t\t\t// Label.\n\t\t\t\tlet label = document.createElement( 'label' );\n\t\t\t\tlabel.setAttribute( 'for', component.id );\n\t\t\t\tlabel.innerText = component.label;\n\n\t\t\t\t// Component container.\n\t\t\t\tlet field = document.createElement( 'div' );\n\t\t\t\tfield.setAttribute( 'id', component.id );\n\n\t\t\t\t// Error.\n\t\t\t\tlet error = document.createElement( 'div' );\n\t\t\t\terror.setAttribute( 'id', component.id + '-error' );\n\t\t\t\terror.setAttribute( 'role', 'alert' );\n\t\t\t\terror.classList.add( 'field-error' );\n\n\t\t\t\t$cardTokenElement.append( label, field, error );\n\n\t\t\t\t// Create and mount component.\n\t\t\t\tlet mollieComponent = mollie.createComponent( component.component );\n\n\t\t\t\tmollieComponent.mount( '#' + component.id );\n\n\t\t\t\t// Handle errors.\n\t\t\t\tmollieComponent.addEventListener( 'change', ( event ) => {\n\t\t\t\t\terror.textContent = event.error && event.touched ? event.error : '';\n\t\t\t\t} );\n\t\t\t} );\n\n\t\t\t// Create Mollie token on checkout submit.\n\t\t\tconst form = $cardTokenElement.closest( 'form' );\n\n\t\t\tform.addEventListener( 'submit', async ( e ) => {\n\t\t\t\t// Check existing card token input.\n\t\t\t\tlet cardTokenInput = form.querySelector( 'input[name=\"pronamic_pay_mollie_card_token\"]' );\n\n\t\t\t\tif ( cardTokenInput ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\te.preventDefault();\n\n\t\t\t\t// Create token.\n\t\t\t\tconst { token, error } = await mollie.createToken();\n\n\t\t\t\tif ( error ) {\n\t\t\t\t\tthrow new Error( error.message || '' );\n\t\t\t\t}\n\n\t\t\t\t// Add token to form.\n\t\t\t\tconst tokenInput = document.createElement( 'input' );\n\t\t\t\ttokenInput.setAttribute( 'type', 'text' );\n\t\t\t\ttokenInput.setAttribute( 'name', 'pronamic_pay_mollie_card_token' );\n\t\t\t\ttokenInput.setAttribute( 'value', token );\n\n\t\t\t\tform.append( tokenInput );\n\n\t\t\t\tif ( false !== form.dispatchEvent( new Event( 'pronamic_pay_mollie_components_card_token_added', { cancelable: true } ) ) ) {\n\t\t\t\t\t// Submit form, now containing the hidden card token field.\n\t\t\t\t\t// form.submit(); â€” not working with test meta box\n\t\t\t\t\tform.querySelector( 'input[name=\"' + e.submitter.name + '\"]' ).click();\n\t\t\t\t}\n\t\t\t} );\n\t\t} );\n\t}\n\n\tfunction setupWooCommerce() {\n\t\tconst checkoutForm = document.querySelector( 'form.woocommerce-checkout' );\n\n\t\tif ( ! checkoutForm ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Init components on updated checkout.\n\t\t$( document.body ).on( 'updated_checkout', function( e ) {\n\t\t\tinitMollieComponents( checkoutForm );\n\t\t} );\n\n\t\tconst $form = $( checkoutForm );\n\n\t\t// Prevent placing order, need to create token first.\n\t\t$form.on( 'checkout_place_order_pronamic_pay_credit_card', returnFalse );\n\n\t\t// Re-enable placing order if card token has been added.\n\t\tcheckoutForm.addEventListener( 'pronamic_pay_mollie_components_card_token_added', function( e ) {\n\t\t\te.preventDefault();\n\n\t\t\t$form.off( 'checkout_place_order_pronamic_pay_credit_card', returnFalse );\n\n\t\t\t$form.submit();\n\t\t} );\n\t}\n\n\tfunction returnFalse() {\n\t\treturn false;\n\t}\n\n\t// Init Mollie Components.\n\tdocument.addEventListener( 'DOMContentLoaded', function( e ) {\n\t\tinitMollieComponents( 'form:not(.woocommerce-checkout)' );\n\t} );\n\n\tsetupWooCommerce();\n} )( jQuery );\n"],"mappings":"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"}